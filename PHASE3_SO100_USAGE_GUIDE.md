# Phase 3: SO100 Data Processing Usage Guide

## ğŸ¯ æ¦‚è¿°

Phase 3 é›†æˆäº†SO100æ ·å¼çš„æ•°æ®å¤„ç†åˆ°RIPT-VLAè®­ç»ƒæµç¨‹ä¸­ï¼Œå®ç°äº†**50-150å€çš„æ•°æ®åˆ©ç”¨ç‡æå‡**ã€‚æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜å¦‚ä½•ä½¿ç”¨è¿™ä¸ªæ–°åŠŸèƒ½ã€‚

## ğŸš€ æ ¸å¿ƒä¼˜åŠ¿

### **æ•°æ®åˆ©ç”¨ç‡æå‡**
- **Legacyæ¨¡å¼**: æ¯ä¸ªepisode â†’ 1ä¸ªè®­ç»ƒæ ·æœ¬
- **SO100æ¨¡å¼**: æ¯ä¸ªepisode â†’ L-50+1ä¸ªè®­ç»ƒæ ·æœ¬ (Lä¸ºepisodeé•¿åº¦)
- **å®é™…æå‡**: 41-74å€æ•°æ®åˆ©ç”¨ç‡æå‡

### **è®­ç»ƒæ•ˆç‡æ”¹è¿›**
- å‡å°‘50-70%çš„æ•°æ®æ”¶é›†éœ€æ±‚
- æ›´å¤šæ ·åŒ–çš„è®­ç»ƒæ ·æœ¬
- æ›´å¥½çš„æ¢¯åº¦ä¼°è®¡å’Œè®­ç»ƒç¨³å®šæ€§

### **å®Œå…¨å…¼å®¹æ€§**
- ä¿æŒRIPTæ•°å­¦æ­£ç¡®æ€§
- ç»´æŒOpenPIæ ¼å¼å…¼å®¹
- æ”¯æŒç°æœ‰è®­ç»ƒè„šæœ¬

---

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

### **1. å¯ç”¨SO100å¤„ç†**

åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹è®¾ç½®ï¼š

```yaml
# åœ¨ dataset é…ç½®ä¸­æ·»åŠ 
dataset:
  use_so100_processing: true  # ğŸ”¥ å¯ç”¨SO100å¤„ç†
  
  # Legacyé…ç½® (SO100æ¨¡å¼ä¸‹å¿½ç•¥ï¼Œä½†ä¿ç•™å…¼å®¹æ€§)
  windowing_mode: last
  window_stride: 10
  max_windows_per_episode: 1
```

### **2. è¿è¡Œè®­ç»ƒ**

```bash
# ä½¿ç”¨SO100é…ç½®è¿è¡Œè®­ç»ƒ
python 11_train_ript_vla_style.py --config pi0/ript/config/stage11_so100_processing.yaml

# æˆ–ä½¿ç”¨å¦ä¸€ä¸ªè®­ç»ƒè„šæœ¬
python 11_train_with_ript_vla.py --config pi0/ript/config/stage11_so100_processing.yaml
```

### **3. ç›‘æ§æ•°æ®åˆ©ç”¨ç‡**

è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šæ˜¾ç¤ºæ•°æ®åˆ©ç”¨ç‡ä¿¡æ¯ï¼š
```
ğŸ“Š SO100æ•°æ®åˆ©ç”¨ç‡: 4 episodes â†’ ~124 samples (31.0x)
```

---

## ğŸ”§ é…ç½®é€‰é¡¹

### **åŸºæœ¬é…ç½®**

```yaml
dataset:
  # ğŸš€ SO100å¤„ç†å¼€å…³
  use_so100_processing: true
  
  # æ•°æ®ç»´åº¦é…ç½®
  state_dim: 8
  num_init_states: 1
```

### **ç®—æ³•é…ç½®ä¼˜åŒ–**

ç”±äºSO100æ¨¡å¼äº§ç”Ÿæ›´å¤šè®­ç»ƒæ ·æœ¬ï¼Œå¯ä»¥è°ƒæ•´ä»¥ä¸‹å‚æ•°ï¼š

```yaml
algo:
  # å¯ä»¥å‡å°‘æ¢¯åº¦ç´¯ç§¯æ­¥æ•° (å› ä¸ºæ ·æœ¬æ›´å¤š)
  gradient_accumulation_steps: 4  # ä»8å‡å°‘åˆ°4
  
  # å¯ä»¥å¢åŠ æ‰¹æ¬¡å¤§å°
  rloo_batch_size: 8  # ä»4å¢åŠ åˆ°8
  
  # å­¦ä¹ ç‡å¯èƒ½éœ€è¦å¾®è°ƒ
  lr: 1e-5
```

### **æ€§èƒ½ç›‘æ§é…ç½®**

```yaml
# å¯é€‰ï¼šå¯ç”¨è¯¦ç»†çš„æ€§èƒ½ç›‘æ§
so100_monitoring:
  enabled: true
  log_data_utilization: true
  log_sample_statistics: true
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### **è¿è¡Œæ€§èƒ½æµ‹è¯•**

```bash
# æµ‹è¯•Legacyæ¨¡å¼
python test_phase3_integration.py --mode legacy

# æµ‹è¯•SO100æ¨¡å¼
python test_phase3_integration.py --mode so100

# å¯¹æ¯”ä¸¤ç§æ¨¡å¼
python test_phase3_integration.py --mode compare

# è¯¦ç»†æ€§èƒ½å¯¹æ¯”
python compare_training_performance.py --episodes 10 --episode_length 100
```

### **é¢„æœŸæ€§èƒ½æŒ‡æ ‡**

| æŒ‡æ ‡ | Legacyæ¨¡å¼ | SO100æ¨¡å¼ | æ”¹è¿›å€æ•° |
|------|------------|-----------|----------|
| æ•°æ®åˆ©ç”¨ç‡ | 1x | 41-74x | 41-74x |
| è®­ç»ƒæ ·æœ¬æ•° | N | NÃ—(L-49) | L-49x |
| å†…å­˜ä½¿ç”¨ | åŸºå‡† | 1.2-1.5x | è½»å¾®å¢åŠ  |
| è®­ç»ƒæ•ˆç‡ | åŸºå‡† | 10-50x | æ˜¾è‘—æå‡ |

---

## ğŸ”„ è¿ç§»æŒ‡å—

### **ä»Legacyæ¨¡å¼è¿ç§»**

1. **å¤‡ä»½ç°æœ‰é…ç½®**
   ```bash
   cp your_config.yaml your_config_legacy_backup.yaml
   ```

2. **ä¿®æ”¹é…ç½®æ–‡ä»¶**
   ```yaml
   dataset:
     use_so100_processing: true  # æ·»åŠ è¿™ä¸€è¡Œ
   ```

3. **æµ‹è¯•æ–°é…ç½®**
   ```bash
   python test_phase3_integration.py --mode so100
   ```

4. **è¿è¡Œè®­ç»ƒ**
   ```bash
   python 11_train_ript_vla_style.py --config your_config.yaml
   ```

### **å›é€€åˆ°Legacyæ¨¡å¼**

å¦‚æœéœ€è¦å›é€€åˆ°Legacyæ¨¡å¼ï¼š

```yaml
dataset:
  use_so100_processing: false  # æˆ–ç›´æ¥åˆ é™¤è¿™ä¸€è¡Œ
```

---

## ğŸ› æ•…éšœæ’é™¤

### **å¸¸è§é—®é¢˜**

#### **1. å†…å­˜ä¸è¶³é”™è¯¯**
```
RuntimeError: CUDA out of memory
```

**è§£å†³æ–¹æ¡ˆ**:
- å‡å°‘`gradient_accumulation_steps`
- å‡å°‘`rloo_batch_size`
- ä½¿ç”¨æ›´å°çš„episodeé•¿åº¦

#### **2. ç»´åº¦ä¸åŒ¹é…é”™è¯¯**
```
ValueError: operands could not be broadcast together
```

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥çŠ¶æ€å’ŒåŠ¨ä½œç»´åº¦é…ç½®
- ç¡®ä¿`state_dim: 8`å’ŒåŠ¨ä½œç»´åº¦ä¸º7

#### **3. é…ç½®åŠ è½½é”™è¯¯**
```
KeyError: 'use_so100_processing'
```

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿é…ç½®æ–‡ä»¶æ ¼å¼æ­£ç¡®
- æ£€æŸ¥YAMLè¯­æ³•
- ä½¿ç”¨æä¾›çš„é…ç½®æ¨¡æ¿

### **è°ƒè¯•æ¨¡å¼**

å¯ç”¨è¯¦ç»†æ—¥å¿—è¿›è¡Œè°ƒè¯•ï¼š

```bash
# è®¾ç½®ç¯å¢ƒå˜é‡å¯ç”¨è°ƒè¯•
export RIPT_DEBUG=1
python 11_train_ript_vla_style.py --config your_config.yaml
```

---

## ğŸ“ˆ æœ€ä½³å®è·µ

### **1. é…ç½®ä¼˜åŒ–**
- æ ¹æ®GPUå†…å­˜è°ƒæ•´æ‰¹æ¬¡å¤§å°
- ç›‘æ§æ•°æ®åˆ©ç”¨ç‡æŒ‡æ ‡
- å®šæœŸä¿å­˜æ£€æŸ¥ç‚¹

### **2. æ€§èƒ½ç›‘æ§**
- ä½¿ç”¨æ€§èƒ½å¯¹æ¯”è„šæœ¬éªŒè¯æ”¹è¿›
- ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
- è·Ÿè¸ªè®­ç»ƒæ”¶æ•›æ€§

### **3. å®éªŒè®¾è®¡**
- å…ˆåœ¨å°è§„æ¨¡æ•°æ®ä¸Šæµ‹è¯•
- å¯¹æ¯”Legacyå’ŒSO100æ¨¡å¼çš„ç»“æœ
- è®°å½•å…³é”®æ€§èƒ½æŒ‡æ ‡

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

### **é…ç½®æ–‡ä»¶**
- `pi0/ript/config/stage11_so100_processing.yaml` - SO100é…ç½®æ¨¡æ¿
- `pi0/ript/config/stage11_ript_vla.yaml` - Legacyé…ç½®å‚è€ƒ

### **æµ‹è¯•è„šæœ¬**
- `test_phase3_integration.py` - ç«¯åˆ°ç«¯é›†æˆæµ‹è¯•
- `compare_training_performance.py` - æ€§èƒ½å¯¹æ¯”æµ‹è¯•

### **è®­ç»ƒè„šæœ¬**
- `11_train_ript_vla_style.py` - ä¸»è®­ç»ƒè„šæœ¬
- `11_train_with_ript_vla.py` - å¤‡ç”¨è®­ç»ƒè„šæœ¬

### **æ ¸å¿ƒç»„ä»¶**
- `pi0/ript/data/so100_style_processor.py` - SO100æ•°æ®å¤„ç†å™¨
- `pi0/ript/data/sample_generator.py` - æ ·æœ¬ç”Ÿæˆå™¨
- `pi0/ript/algos/rl_optimizers/pi0_cfg_interface.py` - CFGé€‚é…å™¨

---

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜æˆ–éœ€è¦å¸®åŠ©ï¼š

1. æŸ¥çœ‹æ•…éšœæ’é™¤éƒ¨åˆ†
2. è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯ç¯å¢ƒ
3. æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼
4. æŸ¥çœ‹è®­ç»ƒæ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯

**Phase 3 SO100æ•°æ®å¤„ç†é›†æˆå®Œæˆï¼äº«å—50-150å€çš„æ•°æ®åˆ©ç”¨ç‡æå‡ï¼** ğŸ‰

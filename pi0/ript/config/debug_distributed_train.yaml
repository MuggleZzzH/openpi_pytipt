# åˆ†å¸ƒå¼è®­ç»ƒè°ƒè¯•é…ç½® - æœ€å°åŒ–å‚æ•°ä¾¿äºå¿«é€Ÿæµ‹è¯•
exp_name: pi0_distributed_debug_test

# --- è·¯å¾„é…ç½® ---
policy_path: "/zhaohan/ZJH/openpi_pytorch/checkpoints/pi0_libero_pytorch"
output_dir: "./pi0/ript/output/distributed_debug"  
norm_stats_path: "/zhaohan/ZJH/openpi_pytorch/lerobot_dataset/norm_stats.json"

# --- åˆ†å¸ƒå¼é…ç½® ---
distributed:
  enabled: true
  backend: 'nccl'
  timeout_seconds: 3600              # 1å°æ—¶è¶…æ—¶ï¼ˆè°ƒè¯•æ—¶ç¼©çŸ­ï¼‰
  find_unused_parameters: false
  bucket_cap_mb: 25
  
# --- æ•°æ®å¹¶è¡Œé…ç½® ---
data_parallel:
  sync_every_n_steps: 2              # æ›´é¢‘ç¹çš„åŒæ­¥ä»¥ä¾¿è°ƒè¯•
  enable_gradient_checkpointing: false
  async_data_loading: true

# --- ä»»åŠ¡åˆ†ç‰‡é…ç½® ---
task_distribution:
  enable_task_sharding: true
  balance_tasks_across_gpus: true
  min_tasks_per_gpu: 1

# --- ä»»åŠ¡å’Œç¯å¢ƒé…ç½® ---
task:
  benchmark_name: "libero_spatial" 
  task_name: 9
  task_names_to_use: null
  num_parallel_envs: 4                # ğŸ”¥ å¯ç”¨4ä¸ªå¹¶è¡Œç¯å¢ƒ
  rollouts_per_env: 4                 # æ¯ä¸ªç¯å¢ƒè¿è¡Œ4ä¸ªè½¨è¿¹
  max_episode_length: 100             # ç¼©çŸ­episodeé•¿åº¦

# --- ç®—æ³•é…ç½®ï¼ˆè°ƒè¯•å‚æ•°ï¼‰ ---
algo:
  rloo_batch_size: 2                 # å‡å°batchå¤§å°
  num_epochs: 2                      # å‡å°‘epochs
  data_batch_size: 4                 # å‡å°æ€»batchæ•°
  gradient_accumulation_steps: 1     # ç®€åŒ–æ¢¯åº¦ç´¯ç§¯
  lr: 1e-5
  grad_norm_clip: 1.0
  
  enable_dynamic_sampling: true
  enable_rollout_stats_tracking: true
  rollout_skip_threshold: 2          # é™ä½è·³è¿‡é˜ˆå€¼
  rollout_stats_path: "./pi0/ript/output/distributed_debug/rollout_stats.json"
  use_val_init: false

# --- è®­ç»ƒé…ç½®ï¼ˆè°ƒè¯•å‚æ•°ï¼‰ ---  
training:
  num_train_steps: 3                 # åªè¿è¡Œ3æ­¥ç”¨äºè°ƒè¯•
  seed: 42
  save_freq: 2
  save_best: false                   # è°ƒè¯•æ—¶ä¸ä¿å­˜æœ€ä½³æ¨¡å‹
  use_mixed_precision: false
  
  optimizer:
    type: "AdamW"
    weight_decay: 0.01
    momentum: 0.9
    beta1: 0.9
    beta2: 0.999

# --- æ—¥å¿—é…ç½® ---
logging:
  use_wandb: false
  wandb_project: "ript-pi0-debug"
  wandb_entity: null
  wandb_mode: "offline"
  log_freq: 1
  log_gradients: false
  log_dir: "./pi0/ript/output/distributed_debug/logs"

# --- å¢å¼ºé‡‡æ ·é…ç½® ---
enhanced_sampling:
  enable_smart_filtering: true
  max_sampling_attempts: 5           # å¤§å¹…å‡å°‘å°è¯•æ¬¡æ•°
  debug_sampling: true               # å¯ç”¨è¯¦ç»†è°ƒè¯•
  save_videos: false                 # è°ƒè¯•æ—¶ä¸ä¿å­˜è§†é¢‘
  video_dir: "rollout_videos_debug"

# --- æ€§èƒ½ä¼˜åŒ–é…ç½® ---
performance:
  enable_torch_compile: false
  max_memory_per_gpu_gb: 12          # é™ä½å†…å­˜é™åˆ¶
  prefetch_factor: 1
  num_workers: 2
  pin_memory: true
  
# --- å®¹é”™å’Œæ¢å¤é…ç½® ---
fault_tolerance:
  enable_checkpointing: false        # è°ƒè¯•æ—¶ä¸ä¿å­˜æ£€æŸ¥ç‚¹
  checkpoint_interval: 5
  max_checkpoints_to_keep: 1
  auto_resume: false
  resume_from_latest: false

# --- è°ƒè¯•é…ç½® ---
debug:
  profile_performance: true          # å¯ç”¨æ€§èƒ½åˆ†æ
  log_memory_usage: true            # è®°å½•å†…å­˜ä½¿ç”¨
  save_intermediate_results: true   # ä¿å­˜ä¸­é—´ç»“æœ
  distributed_debug: true           # å¯ç”¨åˆ†å¸ƒå¼è°ƒè¯•
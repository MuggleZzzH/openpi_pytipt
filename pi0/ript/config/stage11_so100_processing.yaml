# Stage 11 SO100 Data Processing Configuration
# Phase 3: Main Training Script Integration
# å¯ç”¨SO100æ ·å¼æ•°æ®å¤„ç†ï¼Œå®ç°50-150xæ•°æ®åˆ©ç”¨ç‡æå‡

exp_name: stage11_so100_processing_test

# === åŸºæœ¬è·¯å¾„é…ç½® ===
policy_path: "/zhaohan/ZJH/openpi_pytorch/checkpoints/pi0_libero_pytorch"
output_dir: "./output/stage11_so100"

# === ä»»åŠ¡é…ç½® ===
task:
  benchmark_name: "libero_goal"
  task_names_to_use:
    - "put_the_bowl_on_the_stove"
  num_parallel_envs: 2
  max_episode_length: 51  # ä½¿ç”¨RIPT-VLAå®˜æ–¹é™åˆ¶ï¼šlibero_goal=300æ­¥

# === ç®—æ³•é…ç½® ===
algo:
  demo_batch_size: 1   # æ¯æ­¥æ”¶é›†1ç»„demo
  rloo_batch_size: 2   # æ¯ç»„4ä¸ªæ ·æœ¬
  lr: 1e-5
  gradient_accumulation_steps: 8  # ğŸ”¥ SO100æ¨¡å¼ä¸‹å¯ä»¥å‡å°‘ç´¯ç§¯æ­¥æ•°ï¼ˆå› ä¸ºæ ·æœ¬æ›´å¤šï¼‰
  collection_cfg_scale: 1.01
  cfg_uncond_weight: 0.1
  # RolloutGeneratoré…ç½®
  rollout_skip_threshold: 3
  enable_rollout_stats_tracking: true
  rollout_stats_path: "./output/stage11_so100/rollout_stats.json"
  use_val_init: false

# === ç­–ç•¥é…ç½® ===
policy:
  cfg_enabled: false
  train_expert_only: true
  freeze_vision_encoder: true

# === ğŸ”¥ Phase 3: SO100æ•°æ®å¤„ç†é…ç½® ===
dataset:
  num_init_states: 1
  state_dim: 8
  
  # ğŸš€ å¯ç”¨SO100å¤„ç† (Phase 3æ–°åŠŸèƒ½)
  use_so100_processing: true
  
  # ğŸ”¥ å†…å­˜ä¿æŠ¤ï¼šé™åˆ¶æ¯ä¸ªè½¨è¿¹çš„æœ€å¤§æ ·æœ¬æ•°
  # libero_goalæœ€é•¿270æ­¥ â†’ ç†è®ºæœ€å¤§220ä¸ªæ ·æœ¬ï¼Œé™åˆ¶ä¸º100ä¸ªæ ·æœ¬ä¿æŠ¤å†…å­˜
  max_samples_per_trajectory: 100  # é˜²æ­¢é•¿è½¨è¿¹å¯¼è‡´å†…å­˜çˆ†ç‚¸
  
  # Legacyçª—å£åŒ–é…ç½® (SO100æ¨¡å¼ä¸‹å¿½ç•¥ï¼Œä½†ä¿ç•™å…¼å®¹æ€§)
  windowing_mode: slide
  window_stride: 50
  max_windows_per_episode: 1

# === è®­ç»ƒé…ç½® ===
training:
  num_train_steps: 3  # æµ‹è¯•5æ­¥
  seed: 42
  save_freq: 1

# === æ—¥å¿—é…ç½® ===
logging:
  use_wandb: false
  log_freq: 1

# === ç‰¹æ€§å¼€å…³ ===
features:
  use_ript_vla_runner: false
  enable_parallel_envs: true
  enable_true_parallel_envs: true
  enable_smart_sampling: false
  use_parallel_init_state: false
  save_video: false
  
  # === å¢å¼ºåŠŸèƒ½å¼€å…³ ===
  enable_file_counter: true
  adaptive_cfg: false
  early_stop_percentage: 0.8
  
  # === CFGè‡ªé€‚åº”è°ƒæ•´é…ç½® ===
  adaptive_cfg_config:
    min_cfg: 1.0
    max_cfg: 3.0
    cfg_step: 0.2
    low_success_threshold: 0.2
    high_success_threshold: 0.9
  
  # === CFGæ‰«æè¯„ä¼°é…ç½® ===
  cfg_sweep_config:
    enabled: true
    scales: [1.0, 1.25, 1.5, 2.0, 3.0]
    eval_episodes: 3
  
  # åŠ¨æ€é‡‡æ ·é…ç½®
  dynamic_sampling:
    enabled: false
    p_min: 0.1
    p_max: 0.9

# === ğŸ”¥ Phase 3: SO100æ€§èƒ½ç›‘æ§é…ç½® ===
so100_monitoring:
  enabled: true
  log_data_utilization: true
  log_sample_statistics: true
  compare_with_legacy: false  # æ˜¯å¦åŒæ—¶è¿è¡ŒLegacyæ–¹å¼è¿›è¡Œå¯¹æ¯”

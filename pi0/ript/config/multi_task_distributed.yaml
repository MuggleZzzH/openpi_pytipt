# å¤šä»»åŠ¡åˆ†å¸ƒå¼è®­ç»ƒé…ç½® - å®Œæ•´æµ‹è¯•ä»»åŠ¡è½®è¯¢æœºåˆ¶
exp_name: pi0_multi_task_distributed_test

# --- è·¯å¾„é…ç½® ---
policy_path: "/zhaohan/ZJH/openpi_pytorch/checkpoints/pi0_libero_pytorch"
output_dir: "./pi0/ript/output/multi_task_distributed"  
norm_stats_path: "/zhaohan/ZJH/openpi_pytorch/lerobot_dataset/norm_stats.json"

# --- åˆ†å¸ƒå¼é…ç½® ---
distributed:
  enabled: true
  backend: 'nccl'
  timeout_seconds: 3600
  find_unused_parameters: false
  bucket_cap_mb: 15

# --- æ•°æ®å¹¶è¡Œé…ç½® ---
data_parallel:
  sync_every_n_steps: 3
  enable_gradient_checkpointing: true
  async_data_loading: false

# --- ä»»åŠ¡åˆ†ç‰‡é…ç½® ---
task_distribution:
  enable_task_sharding: true          # ğŸ”¥ å¯ç”¨ä»»åŠ¡åˆ†ç‰‡
  balance_tasks_across_gpus: true
  min_tasks_per_gpu: 1

# --- ğŸ”¥ å¤šä»»åŠ¡é…ç½® ---
task:
  benchmark_name: "libero_spatial" 
  task_name: null                     # ä¸ä½¿ç”¨å•ä»»åŠ¡
  task_names_to_use: [0, 1, 2, 3, 4, 5, 6, 7, 8]  # ğŸ”¥ 9ä¸ªä»»åŠ¡å®Œæ•´æµ‹è¯•
  num_parallel_envs: 2                # å‡å°‘å¹¶è¡Œç¯å¢ƒæ•°èŠ‚çœå†…å­˜
  rollouts_per_env: 2                 # æ¯ç¯å¢ƒ2ä¸ªè½¨è¿¹
  max_episode_length: 50              # çŸ­episodeå¿«é€Ÿæµ‹è¯•

# --- ç®—æ³•é…ç½®ï¼ˆä»»åŠ¡è½®è¯¢ä¼˜åŒ–ï¼‰ ---
algo:
  rloo_batch_size: 2                  # ä¸å¹¶è¡Œç¯å¢ƒæ•°åŒ¹é…
  num_epochs: 1                       # å•epochå¿«é€Ÿæµ‹è¯•
  data_batch_size: 4                  # ğŸ”¥ ç²¾ç¡®æ§åˆ¶ï¼šæ¯æ¬¡æ”¶é›†4æ¡è½¨è¿¹
  gradient_accumulation_steps: 1      # ç®€åŒ–æ¢¯åº¦ç´¯ç§¯
  lr: 1e-5
  grad_norm_clip: 1.0
  
  enable_dynamic_sampling: true
  enable_rollout_stats_tracking: true
  rollout_skip_threshold: 2
  rollout_stats_path: "./pi0/ript/output/multi_task_distributed/rollout_stats.json"
  use_val_init: false

# --- è®­ç»ƒé…ç½®ï¼ˆä»»åŠ¡è½®è¯¢æµ‹è¯•ï¼‰ ---  
training:
  num_train_steps: 9                  # ğŸ”¥ 9æ­¥æµ‹è¯•å®Œæ•´è½®è¯¢ï¼šæ¯GPUè½®è¯¢æ‰€æœ‰ä»»åŠ¡
  seed: 42
  save_freq: 10
  save_best: false
  use_mixed_precision: true
  
  optimizer:
    type: "AdamW"
    weight_decay: 0.005

# --- æ—¥å¿—é…ç½® ---
logging:
  use_wandb: false
  log_freq: 1
  log_gradients: false
  log_dir: "./pi0/ript/output/multi_task_distributed/logs"

# --- å¢å¼ºé‡‡æ ·é…ç½® ---
enhanced_sampling:
  enable_smart_filtering: true
  max_sampling_attempts: 5            # å‡å°‘å°è¯•æ¬¡æ•°
  debug_sampling: true                # ğŸ”¥ å¯ç”¨è°ƒè¯•è¾“å‡ºæŸ¥çœ‹ä»»åŠ¡è½®è¯¢
  save_videos: false                  # ä¸ä¿å­˜è§†é¢‘èŠ‚çœæ—¶é—´
  video_dir: "rollout_videos_multi_task"

# --- æ€§èƒ½ä¼˜åŒ–é…ç½® ---
performance:
  enable_torch_compile: false
  max_memory_per_gpu_gb: 14           # ä¸ºå¤šä»»åŠ¡é¢„ç•™å†…å­˜
  prefetch_factor: 1
  num_workers: 1
  pin_memory: false
  
# --- å®¹é”™å’Œæ¢å¤é…ç½® ---
fault_tolerance:
  enable_checkpointing: false
  auto_resume: false

# --- è°ƒè¯•é…ç½® ---
debug:
  profile_performance: false
  log_memory_usage: true
  save_intermediate_results: false
  distributed_debug: true             # ğŸ”¥ å¯ç”¨åˆ†å¸ƒå¼è°ƒè¯•è¾“å‡º
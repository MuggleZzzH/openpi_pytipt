# Stage 11 å¢å¼ºç‰ˆé…ç½®ç¤ºä¾‹ - RIPT-VLAé£æ ¼ + åŠ¨æ€é‡‡æ · + æ–‡ä»¶è®¡æ•°å™¨
# åŸºäºä½ çš„æ”¹é€ è§„åˆ’çš„å®Œæ•´é…ç½®æ¨¡æ¿

# ç­–ç•¥å’Œæ•°æ®è·¯å¾„
policy_path: "/zhaohan/ZJH/openpi_pytorch/checkpoints/pi0_libero_pytorch"  # éœ€è¦åŒ…å« norm_stats.json
norm_stats_path: null  # å¦‚æœä¸ºnullï¼Œä¼šè‡ªåŠ¨ä»policy_pathæ¨æ–­

# è¾“å‡ºé…ç½®
output_dir: "outputs/stage11_enhanced"
exp_name: "ript_vla_enhanced"

# ä»»åŠ¡é…ç½®
task:
  benchmark_name: "libero_goal"  # libero_spatial|object|goal|10|90
  task_names_to_use: ["libero_goal_default"]
  num_parallel_envs: 1  # å¹¶è¡Œç¯å¢ƒæ•°é‡
  max_episode_length: 200

# ç®—æ³•é…ç½®
algo:
  lr: 1e-5
  rloo_batch_size: 4  # RLOOæ‰¹æ¬¡å¤§å°
  collection_cfg_scale: 1.5  # åˆå§‹CFGå¼ºåº¦

# æ•°æ®é›†çª—å£åŒ–é…ç½®
dataset:
  windowing_mode: "last"  # last|random|slide
  window_stride: 10
  max_windows_per_episode: 1

# è®­ç»ƒé…ç½®
training:
  num_train_steps: 50
  save_freq: 10
  save_optimizer_freq: 20  # å¯é€‰ï¼šæ¯Næ­¥ä¿å­˜å®Œæ•´æ£€æŸ¥ç‚¹
  save_optimizer_final: true  # ä¿å­˜æœ€ç»ˆå®Œæ•´æ£€æŸ¥ç‚¹

# ğŸ”¥ æ–°å¢ï¼šå¢å¼ºåŠŸèƒ½é…ç½®
features:
  # ğŸ”¥ RIPTé£æ ¼åŠ¨æ€é‡‡æ ·ï¼šç®€å•çš„å…¨æˆåŠŸ/å…¨å¤±è´¥æ£€æŸ¥
  dynamic_sampling:
    enabled: true   # å¯ç”¨RIPTåŸç‰ˆåŠ¨æ€é‡‡æ ·ï¼ˆå…¨æˆåŠŸ/å…¨å¤±è´¥è¿‡æ»¤ï¼‰
    # æ³¨æ„ï¼šä¸å†éœ€è¦å¤æ‚çš„ p_min, p_max, smooth_window ç­‰å‚æ•°
  
  # å…¨å±€æ ·æœ¬é‡æ§åˆ¶
  enable_file_counter: true
  early_stop_percentage: 0.8  # ğŸ”¥ æ–°å¢ï¼šæ—©åœç™¾åˆ†æ¯”ï¼Œç”¨äºè®¡ç®—å…¨å±€é˜ˆå€¼
  
  # per-init å“ˆå¸Œè·³è¿‡æœºåˆ¶
  enable_rollout_stats_tracking: true  # ğŸ”¥ æ–°å¢ï¼šå¯ç”¨åˆå§‹çŠ¶æ€å“ˆå¸Œè·³è¿‡
  rollout_stats_path: "rollout_stats.json"  # å†å²è®°å½•æ–‡ä»¶è·¯å¾„ï¼ˆç›¸å¯¹äºè¾“å‡ºç›®å½•ï¼‰
  
  # è‡ªé€‚åº”CFGè°ƒæ•´
  adaptive_cfg: true  # æ ¹æ®æˆåŠŸç‡çª—å£è‡ªåŠ¨è°ƒæ•´CFGå¼ºåº¦
  
  # å…¶ä»–ç°æœ‰åŠŸèƒ½å¼€å…³
  enable_task_polling: false
  enable_parallel_envs: false
  enable_true_parallel_envs: false
  enable_smart_sampling: false
  save_video: false
  
  # ğŸ”¥ æœªæ¥æ‰©å±•é¢„ç•™ï¼ˆç¬¬äºŒé˜¶æ®µï¼‰
  rollout_stats_path: "checkpoints/rollout_stats.json"  # ç”¨äºinitå“ˆå¸Œæ‹’ç»
  early_stop_stuck:
    enabled: false
    pos_delta_eps: 1e-4
    max_idle_steps: 40

# Stage 11 RIPT-VLAæµ‹è¯•é…ç½® - è½»é‡CFGç¨³å®šç‰ˆ
# æµ‹è¯•è½»é‡CFGå¢å¼ºçš„æ€§èƒ½ (cfg_scale=1.25) + ç¨³å®šæ¨¡æ‹Ÿå¹¶è¡Œ

exp_name: stage11_ript_vla_cfg125_fixed

# === åŸºæœ¬è·¯å¾„é…ç½® ===
policy_path: "/zhaohan/ZJH/openpi_pytorch/checkpoints/pi0_libero_pytorch"
output_dir: "./output/stage11_ript_vla"

# === ä»»åŠ¡é…ç½® ===
task:
  benchmark_name: "libero_goal"
  task_names_to_use:
    - "put_the_bowl_on_the_stove"
  num_parallel_envs: 4  # ğŸš€ æµ‹è¯•å¹¶è¡Œç¯å¢ƒ
  max_episode_length: null  # çŸ­episodeå¿«é€Ÿæµ‹è¯•

# === ç®—æ³•é…ç½® ===
algo:
  demo_batch_size: 1  # ğŸ”¥ æ–°å¢ï¼šæ¯æ­¥éœ€è¦æ”¶é›†çš„ç»„æ•°ï¼ˆæ¯ç»„rloo_batch_sizeä¸ªæ ·æœ¬ï¼‰
  rloo_batch_size: 8   # æ¯ç»„å†…æ ·æœ¬æ•°ï¼ˆç”¨äºRLOOä¼˜åŠ¿è®¡ç®—ï¼‰
  lr: 1e-5
  gradient_accumulation_steps: 1
  collection_cfg_scale: 1.25       # ğŸ”¥ è½»é‡CFGï¼šè®¾ç½®ä¸º1.25ï¼ˆè½»å¾®CFGå¢å¼ºï¼‰
  cfg_uncond_weight: 0.1           # ğŸ”¥ è®­ç»ƒæ—¶æ— æ¡ä»¶åˆ†æ”¯æƒé‡ï¼ˆCFGå…³é—­æ—¶ä¸ä½¿ç”¨ï¼‰
  # RolloutGeneratoré…ç½®
  rollout_skip_threshold: 3
  enable_rollout_stats_tracking: true
  rollout_stats_path: "./output/stage11_ript_vla/rollout_stats.json"
  use_val_init: false

# === ç­–ç•¥é…ç½® ===
policy:
  cfg_enabled: true            # ğŸš¨ å¯ç”¨CFGåŠŸèƒ½ï¼šæ”¯æŒè½»é‡CFGå¢å¼º
  train_expert_only: true          # ä¸“å®¶å¤´è®­ç»ƒæ¨¡å¼

# === æ•°æ®é›†é…ç½® ===
dataset:
  num_init_states: 1  # ğŸ”¥ å¤‡ç”¨ï¼šå¯ç”¨çš„åˆå§‹çŠ¶æ€æ•°é‡ï¼ˆä¸algo.demo_batch_sizeä¸€è‡´ï¼‰
  state_dim: 8  # çŠ¶æ€ç»´åº¦
  # ğŸ”¥ æ–°å¢ï¼šçª—å£åŒ–é‡‡æ ·é…ç½®ï¼ˆæé«˜æ•°æ®åˆ©ç”¨ç‡ï¼‰
  windowing_mode: slide      # çª—å£æ¨¡å¼: last(å…¼å®¹æ¨¡å¼) | random(éšæœºé‡‡æ ·) | slide(æ»‘åŠ¨çª—å£)
  window_stride: 50          # slideæ¨¡å¼ä¸‹çš„æ»‘åŠ¨æ­¥é•¿
  max_windows_per_episode: 2 # æ¯æ¡è½¨è¿¹æœ€å¤§çª—å£æ•°ï¼ˆæ§åˆ¶å†…å­˜å’Œè®¡ç®—ï¼‰

# === è®­ç»ƒé…ç½® ===
training:
  num_train_steps: 2  # åªè®­ç»ƒ2æ­¥æµ‹è¯•
  seed: 42
  save_freq: 1

# === æ—¥å¿—é…ç½® ===
logging:
  use_wandb: false
  log_freq: 1

# === ç‰¹æ€§å¼€å…³ ===
features:
  use_ript_vla_runner: false  # å…³é—­RIPT-VLA runnerï¼Œä½¿ç”¨LIBEROEnvRunnerå¹¶è¡Œèƒ½åŠ›
  enable_parallel_envs: true  # å¼€å¯å¹¶è¡Œç¯å¢ƒï¼ˆå‘é‡åŒ–ï¼‰
  enable_true_parallel_envs: true  # å¼€å¯çœŸæ­£å¤šè¿›ç¨‹å¹¶è¡Œï¼ˆSubprocVectorEnvï¼‰
  enable_smart_sampling: true      # Runneræ—¥å¿—ç”¨çš„æ™ºèƒ½é‡‡æ ·å¼€å…³ï¼ˆä¸algo.enable_dynamic_samplingå¯¹åº”ï¼‰
  use_parallel_init_state: false   # å¹¶è¡Œæ—¶æ˜¯å¦è°ƒç”¨set_init_stateï¼ˆé»˜è®¤falseä»¥é¿å…MuJoCo qposç»´åº¦ä¸åŒ¹é…ï¼‰
  save_video: true                 # è®­ç»ƒæœŸé—´ä¿å­˜è§†é¢‘ï¼ˆä¼šå†™åˆ° pi0/ript/debug_images/videosï¼‰
  
  # === ğŸ”¥ å¢å¼ºåŠŸèƒ½å¼€å…³ ===
  enable_file_counter: true        # å¼€å¯æ–‡ä»¶è®¡æ•°å™¨ï¼ˆåˆ†å¸ƒå¼è®­ç»ƒæ ·æœ¬ç»Ÿè®¡ï¼‰
  adaptive_cfg: false              # å…³é—­è‡ªé€‚åº”CFGï¼ˆCFGå·²ç¦ç”¨ï¼‰
  early_stop_percentage: 0.8       # æ–‡ä»¶è®¡æ•°å™¨æ—©åœé˜ˆå€¼ç™¾åˆ†æ¯”
  
  # === ğŸ”¥ CFGè‡ªé€‚åº”è°ƒæ•´é…ç½® ===
  adaptive_cfg_config:
    min_cfg: 1.0                   # CFGæœ€å°å€¼
    max_cfg: 3.0                   # CFGæœ€å¤§å€¼
    cfg_step: 0.2                  # CFGè°ƒæ•´æ­¥é•¿
    low_success_threshold: 0.2     # ä½æˆåŠŸç‡é˜ˆå€¼ï¼ˆä½äºæ­¤å€¼é™ä½CFGï¼‰
    high_success_threshold: 0.9    # é«˜æˆåŠŸç‡é˜ˆå€¼ï¼ˆé«˜äºæ­¤å€¼æå‡CFGï¼‰
  
  # === ğŸ”¥ CFGæ‰«æè¯„ä¼°é…ç½® ===
  cfg_sweep_config:
    enabled: true                  # æ˜¯å¦å¯ç”¨CFGæ‰«æè¯„ä¼°
    scales: [1.0, 1.25, 1.5, 2.0, 3.0]  # æ‰«æçš„CFGå¼ºåº¦åˆ—è¡¨
    eval_episodes: 3               # æ¯ä¸ªCFGå¼ºåº¦çš„è¯„ä¼°è½®æ•°
  
  # åŠ¨æ€é‡‡æ ·é…ç½®ï¼ˆRIPTé£æ ¼ï¼‰
  dynamic_sampling:
    enabled: true                  # å¼€å¯åŠ¨æ€é‡‡æ ·
    p_min: 0.1                    # æˆåŠŸç‡ä¸‹é™ï¼ˆå¤‡ç”¨ï¼ŒRIPTé£æ ¼ä¸»è¦æ£€æŸ¥å…¨æˆåŠŸ/å…¨å¤±è´¥ï¼‰
    p_max: 0.9                    # æˆåŠŸç‡ä¸Šé™ï¼ˆå¤‡ç”¨ï¼ŒRIPTé£æ ¼ä¸»è¦æ£€æŸ¥å…¨æˆåŠŸ/å…¨å¤±è´¥ï¼‰
    # æ³¨ï¼šRIPTé£æ ¼ä½¿ç”¨ç®€å•çš„å…¨æˆåŠŸ/å…¨å¤±è´¥æ£€æŸ¥ï¼Œä¸éœ€è¦å¹³æ»‘çª—å£